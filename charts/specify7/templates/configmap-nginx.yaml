apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "specify7.fullname" . }}-nginx-config
  labels:
    {{- include "specify7.labels" . | nindent 4 }}
data:
  default.conf: |
    server {
        listen 80;
        server_name localhost;
        root /volumes/static-files;

        # Health check
        location /healthz {
            access_log off;
            return 200 "OK";
        }

        # Static file serving with rewrites to match Specify structure
        
        # 1. Config generated by the backend
        location /static/config/ {
            alias /volumes/specify-config/;
        }
        
        # 2. Depository (Exports)
        location /static/depository/ {
            alias /volumes/static-files/depository/;
        }
        
        # 3. Webpack output (JS/CSS bundles)
        location /static/js/ {
            alias /volumes/webpack-output/js/;
        }

        location /static/img/ {
            alias /volumes/webpack-output/img/;
        }
        
        # 4. General static files (frontend assets, admin interface)
        location /static/ {
            alias /volumes/static-files/frontend-static/;
        }
    }
